{% extends 'base.html' %}

{% block title %}Blog - {{ post.title }}{% endblock %}

{% block content %}
<article class="post-detail">
    <div class="container">
        <div class="post-header">
            <div class="post-meta">
                {% if post.category %}
                <a href="{{ url_for('blog_category', slug=post.category.slug) }}" class="post-category">
                    {{ post.category.name }}
                </a>
                {% endif %}
                <span class="post-date">
                    {{ post.published_date.strftime('%B %d, %Y') if post.published_date else post.created_date.strftime('%B %d, %Y') }}
                </span>
                <span class="post-reading-time">
                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="display: inline-block; vertical-align: middle; margin-right: 0.25rem;">
                        <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
                    </svg>
                    {{ post.get_reading_time() }} min read
                </span>
                <span class="post-views">
                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="display: inline-block; vertical-align: middle; margin-right: 0.25rem;">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
                    </svg>
                    {{ post.views_count }} views
                </span>
            </div>
            <h1 class="post-title">{{ post.title }}</h1>
            {% if post.excerpt %}
            <p class="post-excerpt-large">{{ post.excerpt }}</p>
            {% endif %}
            <div class="post-author">
                <span>By Agrim Sharma</span>
            </div>
        </div>

        {% if post.featured_image and post.featured_image.strip() %}
        <div class="post-featured-image">
            {% if post.featured_image.startswith('http') %}
            <img src="{{ post.featured_image }}" alt="{{ post.title }}" loading="lazy" onerror="this.style.display='none'; this.parentElement.style.display='none';">
            {% else %}
            <img src="{{ url_for('uploaded_file', file_type='images', filename=post.featured_image) }}" alt="{{ post.title }}" loading="lazy" onerror="this.style.display='none'; this.parentElement.style.display='none';">
            {% endif %}
        </div>
        {% endif %}

        <div class="post-content-wrapper">
            <div class="post-content-main">
                <div class="post-body">
                    {{ post.content|safe }}
                </div>

                <!-- Video Section: Embedded Video -->
                {% if video_embed_url %}
                <div class="post-video-embedded">
                    <h3>Video</h3>
                    <div class="video-container">
                        <iframe src="{{ video_embed_url }}" 
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                        </iframe>
                    </div>
                </div>
                {% endif %}

                <!-- Video Section: Uploaded Video -->
                {% if post.video_file %}
                <div class="post-video-uploaded">
                    <h3>Video</h3>
                    <div class="video-container">
                        <video controls>
                            <source src="{{ url_for('uploaded_file', file_type='videos', filename=post.video_file) }}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
                {% endif %}

                {% if post.tags %}
                <div class="post-tags-section">
                    <h3>Tags:</h3>
                    <div class="post-tags">
                        {% for tag in post.tags %}
                        <a href="{{ url_for('blog_tag', slug=tag.slug) }}" class="tag-link">{{ tag.name }}</a>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <div class="post-navigation">
                    <a href="{{ url_for('blog_list') }}" class="btn btn-outline">← Back to Blog</a>
                </div>
            </div>
        </div>

        {% if related_posts %}
        <section class="related-posts">
            <h2>Related Posts</h2>
            <div class="related-posts-grid">
                {% for related_post in related_posts %}
                <div class="related-post-card">
                    {% if related_post.featured_image %}
                    <div class="related-post-image">
                        <a href="{{ url_for('blog_detail', slug=related_post.slug) }}">
                            {% if related_post.featured_image.startswith('http') %}
                            <img src="{{ related_post.featured_image }}" alt="{{ related_post.title }}">
                            {% else %}
                            <img src="{{ url_for('uploaded_file', file_type='images', filename=related_post.featured_image) }}" alt="{{ related_post.title }}">
                            {% endif %}
                        </a>
                    </div>
                    {% endif %}
                    <div class="related-post-content">
                        <h3>
                            <a href="{{ url_for('blog_detail', slug=related_post.slug) }}">{{ related_post.title }}</a>
                        </h3>
                        <p>{{ (related_post.excerpt[:100] if related_post.excerpt else related_post.content[:100]|striptags) }}...</p>
                        <a href="{{ url_for('blog_detail', slug=related_post.slug) }}" class="read-more">Read More →</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}
    </div>
</article>
{% endblock %}

